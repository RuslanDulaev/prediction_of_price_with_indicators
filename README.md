<h1>Прогнозирование динамики цен акций с использованием машинного обучения: классификация рыночных трендов</h1>

<h2>Поставленные задачи</h2>

**Цель:**  
Применение алгоритмов машинного обучения с целью прогнозирования направления движения цен рыночных активов

**Задачи:**  
- Сбор данных для формирования датасета  
- Предобработка данных  
- Выбор и обучение модели  
- Оценка качества модели  

Сбор данных был реализован с Московской биржи от брокера Т-банк. Был получен API-ключ для чтения, с помощью которого можно получать информацию о рыночных активах.

В ходе взаимодействия с API-Т-банка были реализованы следующие функции:
- Получения уникального индентификатора акции
- Преобразование данных в удобочитаемый формат
- Получения японских свеч с отображением максимальной, минимальной цен, цен открытия и закрытия, с последующим формированием датафрейма

<h2>Индикаторы, которые будут выступать в качестве признаков</h2>

<img width="820" alt="image" src="https://github.com/user-attachments/assets/e557753f-eee1-41bd-8e6b-4dddcab5b32b" />
  
<img width="809" alt="image" src="https://github.com/user-attachments/assets/197293d8-0ba9-4bbc-9921-f9f78dc13606" />
  
- EMA - экспоненциальная скользящая средняя. Сглаживает рыночные колебания, рассчитывается, как средняя на основе 9 свечей.
- BOLLINGER BANDS - линии расположены по обе стороны от скользящей средней на расстоянии одного среднеквадратического отклонения. Необходимы для визуализации волатильности рынка.
- RSI - измерение величины и скорости движения цены. Для определения перекупленности и перепроданности.
- MACD - разность между двумя ema с разными периодами и добавления сигнальной линии. Гистограмма - разность между ema в числовом формате.
- ATR - средний истинный диапазон, используется для оценки рыночной волатильности.
- Стохастический осциллятор - показывает положение текущей цены относительно диапазона цен за определенный период в прошлом.
- Фракталы - паттерны, представляющие из себя локальные экстремумы на графике цены.

Все индикаторы кроме фракталов были реализованы с помощью библиотеки TA.
Для фракталов же была написана функция, которая получает на вход датафрейм и номер строки а на выходе выдает True или False.

<h2>Предикторы и целевая переменная</h2>
  
_Было применено масштабирование данных на этапе получения, с целью уравнивания значимости каждой из акций._
  
Наши предикторы находятся в переменной X
<img width="1386" alt="image" src="https://github.com/user-attachments/assets/463f48a6-c94e-4bf3-a7e7-195ba3491cfc" />

В качестве зависимой переменной была сформирована серия, хранящая один из 3 классов:

- 1 класс - акция через 4 свечи выросла минимум на 0.5%
- 2 класс - акция через 4 свечи упала минимум на 0.5%
- 0 класс - акция осталась в начальном диапазоне

<img width="1400" alt="image" src="https://github.com/user-attachments/assets/5d40b7e9-2ef3-4359-81f3-2b8c206fd2a4" />  

**Как итог, задача предсказания цены акции, которая подразумевает задачу регрессии, была переформирована в задачу классификации.**  

  
Матрица корреляций между предикторами и зависимой переменной:  
<img width="797" alt="image" src="https://github.com/user-attachments/assets/7e87541b-5d40-4878-a48d-bb84f7be747a" />

<h2>Обучение модели RandomForestClassifier</h2>  
С целью решения этой задачи классификации, для начало было принято решение обучать модель RandomForestClassifier.  

Визуализация подбора гипперпараметра максимальной глубины.   
<img width="674" alt="image" src="https://github.com/user-attachments/assets/7b42ffd1-3d31-4eb4-8976-273280ee48cf" />    

  
В ходе обучения была применена k-cross валидация на основе 5 фолдов.  

В качестве результатов был получен классификационный отчет.  
<img width="442" alt="image" src="https://github.com/user-attachments/assets/af650cab-b45f-4ece-bc1a-4461ba20f441" />  

Матрица ошибок модели RandomForestClassifier.  
<img width="624" alt="image" src="https://github.com/user-attachments/assets/e2c6969e-6ac5-4f30-b424-056107e67d55" />  

ROC-кривая. По ней мы однозначно понимаем, что класс с ростом цены распознается лучше всего.  
<img width="546" alt="image" src="https://github.com/user-attachments/assets/64519d76-bd34-405f-9471-35361e882d40" />  

Гистограмма важности произнаков. Как мы видим, на первом месте стоит индикатор atr, на втором rsi, на третьем macd.  
<img width="743" alt="image" src="https://github.com/user-attachments/assets/ad150b4b-de27-4f0a-bd87-0a25bb2d89f8" />  

<h2>Обучение других моделей</h2>  

  
Также были обучены модели XGBoost и мультиклассовая логистическая регрессия с k-cross валидацией и подбором оптимальных параметров, однако результаты получились хуже. 
 
Классификационный отчет для XGBoost  
<img width="444" alt="image" src="https://github.com/user-attachments/assets/25de4c52-1b3b-4d27-9b59-b22a73fb5e19" />  

Классификационный отчет для мультиклассовой логистической регрессии  
<img width="448" alt="image" src="https://github.com/user-attachments/assets/46a2b02e-5d08-42ed-b5e9-6c40a33a5c2c" />

<h2>Выводы</h2>

- Обученная модель RandomTreeClassifier показывает среднее качество классификации с точностью 60%.
- Класс 1, который указывает рост цены, распознается лучше всего.
- Ошибки распределены довольно равномерно между классами, что видно из близких значений precision и recall для каждого класса.

